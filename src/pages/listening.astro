---
import Layout from "../layouts/MainLayout.astro";
import Music from "../components/Music.astro";
---

<Layout>
  <div id="music-info">
    <p>Loading current songâ€¦</p>
  </div>
  <Music />
</Layout>

<script>
  async function fetchTopTrack() {
    try {
      const res = await fetch("/.netlify/functions/spotify");
      const data = await res.json();

      const container = document.getElementById("music-info");

      if (!data?.title) {
        container.innerHTML = "<p>No top track found.</p>";
        return;
      }

      container.innerHTML = `
        <div>
          <img src="${data.albumImageUrl}" alt="Album cover" width="64" height="64" />
          <p><strong>${data.title}</strong> by ${data.artist}</p>
          <p>Album: ${data.album}</p>
          <p><a href="${data.songUrl}" target="_blank">Open in Spotify</a></p>
        </div>
      `;
    } catch (err) {
      document.getElementById("music-info").innerHTML =
        "<p>Error loading top track.</p>";
      console.error("Failed to load music:", err);
    }
  }

  fetchTopTrack();
</script>
